<div class="frame">
    <div class="header">
        <button pButton size="small" (click)="goToPrevious()" data-testid="previous-button">
            <div class="chevron">
                <fa-icon [icon]="faChevronLeft" />
            </div>
        </button>
        <button pButton size="small" severity="secondary" (click)="filterPopover.toggle($event)">
            <fa-icon [icon]="faFilter" />
        </button>
        <button data-testid="today-button" pButton size="small" severity="secondary" (click)="goToToday()" jhiTranslate="artemisApp.calendar.todayButtonLabel"></button>
        @let courseId = currentCourseId();
        @let subscriptionToken = calendarSubscriptionToken();
        @if (courseId && subscriptionToken) {
            <div>
                <button data-testid="subscribe-button" pButton size="small" severity="secondary" (click)="subscriptionPopover.open($event)">
                    <fa-icon [icon]="faArrowUpFromBracket" />
                </button>
                <jhi-calendar-subscription-popover [subscriptionToken]="subscriptionToken" [courseId]="courseId" [isMobile]="true" #subscriptionPopover />
            </div>
        }
        <button pButton size="small" (click)="goToNext()" data-testid="next-button">
            <div class="chevron">
                <fa-icon [icon]="faChevronRight" />
            </div>
        </button>
    </div>
    <div class="calendar-presentation-container">
        <div class="presentation-header">
            <div class="presentation-header-top-section">
                <div class="spacer">
                    @if (selectedDate()) {
                        <button type="button" class="close-button" (click)="unselectDate()">
                            <fa-icon [icon]="faXmark" />
                        </button>
                    }
                </div>
                <div class="month-title">{{ firstDateOfCurrentMonth().format('MMMM YYYY') }}</div>
                <div class="spacer"></div>
            </div>
            <div class="presentation-header-bottom-section">
                @for (dayNameKey of weekdayNameKeys; track dayNameKey) {
                    <div class="weekday-label" jhiTranslate="{{ dayNameKey }}"></div>
                }
            </div>
        </div>
        @let day = selectedDate();
        @if (day) {
            <jhi-calendar-mobile-day-presentation [selectedDate]="day" />
        } @else {
            <jhi-calendar-mobile-month-presentation [firstDateOfMonth]="firstDateOfCurrentMonth()" (selectDate)="selectDate($event)" />
        }
        @if (isLoading()) {
            <div class="loading-overlay">
                <div class="spinner-border" role="status"></div>
            </div>
        }
    </div>
</div>

<p-popover #filterPopover>
    <div class="popover-content">
        <div class="filter-option-row">
            <p-checkbox [ngModel]="lectureFilterOptionSelected()" (ngModelChange)="toggleFilterOption(CalendarEventFilterOption.LectureEvents)" [binary]="true" />
            <div class="filter-option-indicator lecture"></div>
            <span jhiTranslate="artemisApp.calendar.filterOption.lectures"></span>
        </div>
        <div class="filter-option-row">
            <p-checkbox [ngModel]="exerciseFilterOptionSelected()" (ngModelChange)="toggleFilterOption(CalendarEventFilterOption.ExerciseEvents)" [binary]="true" />
            <div class="filter-option-indicator exercise"></div>
            <span jhiTranslate="artemisApp.calendar.filterOption.exercises"></span>
        </div>
        <div class="filter-option-row">
            <p-checkbox [ngModel]="tutorialFilterOptionSelected()" (ngModelChange)="toggleFilterOption(CalendarEventFilterOption.TutorialEvents)" [binary]="true" />
            <div class="filter-option-indicator tutorial"></div>
            <span jhiTranslate="artemisApp.calendar.filterOption.tutorials"></span>
        </div>
        <div class="filter-option-row">
            <p-checkbox [ngModel]="examFilterOptionSelected()" (ngModelChange)="toggleFilterOption(CalendarEventFilterOption.ExamEvents)" [binary]="true" />
            <div class="filter-option-indicator exam"></div>
            <span jhiTranslate="artemisApp.calendar.filterOption.exams"></span>
        </div>
    </div>
</p-popover>
